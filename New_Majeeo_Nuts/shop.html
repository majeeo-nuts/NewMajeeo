<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shop All ‚Äì MajeeoNuts Premium Dry Fruits</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand: { red: '#7f1d1d', gold: '#D4AF37', cream: '#F9F5F1', dark: '#1A1A1A' } },
          fontFamily: { sans: ['Poppins', 'sans-serif'], serif: ['Playfair Display', 'serif'] }
        }
      }
    }
  </script>
</head>
<body class="bg-brand-cream text-brand-dark font-sans antialiased">

<!-- Navbar -->
<nav id="navbar" class="sticky top-0 z-50 bg-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
            <button onclick="toggleMenu()" class="lg:hidden text-brand-red p-2"><i class="ri-menu-line text-2xl"></i></button>
            <a href="index.html" class="flex-shrink-0 flex items-center gap-2">
                <img src="assets/images/Product/Images/MajeeoNuts.Logo.png" onerror="this.src='images/MajeeoNuts.Logo.png'" alt="MajeeoNuts" class="h-12 w-auto object-contain">
                <span class="text-2xl font-serif font-bold text-brand-red tracking-tight">MajeeoNuts</span>
            </a>
            <div class="hidden lg:flex items-center space-x-6">
                <a href="index.html" class="text-brand-dark hover:text-brand-red font-medium transition">Home</a>
                <a href="shop.html" class="text-brand-red font-medium transition border-b-2 border-brand-red">Shop All</a>
                <a href="gifting.html" class="text-brand-dark hover:text-brand-red font-medium transition">Gifting</a>
                <a href="contact.html" class="text-brand-dark hover:text-brand-red font-medium transition">Contact Us</a>
                <input id="searchInput" type="text" placeholder="Search dry fruits..." class="px-3 py-2 rounded-full border border-gray-300 focus:ring-2 focus:ring-brand-red w-64 text-sm">
            </div>
            <div class="flex items-center space-x-4 text-brand-red">
                <a href="account.html" class="hover:text-brand-gold transition"><i class="ri-user-line text-xl"></i></a>
                <button onclick="toggleCartSidebar()" class="relative hover:text-brand-gold transition">
                    <i class="ri-shopping-bag-line text-xl"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-brand-gold text-brand-red text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full transition">0</span>
                </button>
            </div>
        </div>
    </div>
    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-40 hidden" onclick="toggleMenu()"></div>
    <div id="mobile-sidebar" class="fixed top-0 left-0 w-3/4 max-w-xs h-full bg-white z-50 transform -translate-x-full transition-transform duration-300 shadow-2xl">
        <div class="p-5 flex justify-between items-center border-b">
            <span class="font-serif font-bold text-xl text-brand-red">Menu</span>
            <button onclick="toggleMenu()"><i class="ri-close-line text-2xl"></i></button>
        </div>
        <div class="flex flex-col p-5 space-y-4 text-base font-medium">
            <a href="index.html" class="text-brand-dark">Home</a>
            <a href="shop.html" class="text-brand-dark">Shop All</a>
            <a href="gifting.html" class="text-brand-dark">Gifting</a>
            <a href="contact.html" class="text-brand-dark">Contact Us</a>
            <a href="cart.html" class="text-brand-dark">Cart</a>
            <a href="account.html" class="text-brand-dark">Account</a>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="text-center mb-10">
        <h1 class="text-4xl md:text-5xl font-serif font-bold text-brand-red mb-2">Our Premium Collection</h1>
    </div>
    <section class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="product-grid-container"></section>
    <div id="no-results" class="text-center text-xl text-gray-500 mt-12 hidden"><p>Sorry, no products matched.</p></div>
</main>

<!-- Cart Sidebar -->
<aside id="cart-sidebar" class="fixed top-0 right-0 w-full max-w-sm h-full bg-white z-50 shadow-2xl transform translate-x-full transition-transform duration-300">
    <div class="h-full flex flex-col p-6">
        <div class="flex justify-between items-center mb-4 border-b pb-3">
            <h2 class="text-xl font-serif font-bold text-brand-red">Your Bag</h2>
            <button onclick="toggleCartSidebar()" class="text-brand-dark"><i class="ri-close-line text-2xl"></i></button>
        </div>
        <div id="cart-items" class="flex-grow overflow-y-auto space-y-4 text-sm"></div>
        <div class="mt-auto pt-4 border-t border-gray-200">
            <div class="flex justify-between font-bold text-brand-dark mb-3"><span>Total:</span><span id="cart-total">‚Çπ0.00</span></div>
            <div class="mb-3">
                <label class="text-xs text-gray-500 mb-1 block">Email for Invoice/Receipt:</label>
                <input type="email" id="customer-email" placeholder="Enter your email" class="w-full p-2 border border-gray-300 rounded text-sm focus:border-brand-red outline-none">
            </div>
            <a href="cart.html" class="block w-full bg-brand-dark text-white text-center py-3 rounded-xl mb-2 font-bold text-sm hover:bg-gray-800">View Full Cart</a>
            <button id="checkout-btn" class="w-full bg-brand-red text-white py-3 rounded-xl font-bold hover:bg-red-800 disabled:opacity-50 disabled:cursor-not-allowed transition">Proceed to Pay</button>
        </div>
    </div>
</aside>
<div id="cart-overlay" class="fixed inset-0 bg-black/50 z-40 hidden" onclick="toggleCartSidebar()"></div>

<footer class="bg-brand-dark text-white pt-16 pb-8 mt-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <img src="assets/images/Product/Images/MajeeoNuts.Logo.png" onerror="this.src='images/MajeeoNuts.Logo.png'" class="h-10 grayscale brightness-200 mb-4">
                <p class="text-gray-400 text-sm">Premium Dry Fruits.</p>
            </div>
            <div>
                 <h4 class="text-brand-gold font-bold mb-4 text-sm">Contact</h4>
                 <ul class="text-gray-400 text-sm space-y-2">
                    <li>üìç Mumbai, India</li>
                    <li>‚úâÔ∏è maheshgawade7799@gmail.com</li>
                    <li>üìû +91-8369245051</li>
                 </ul>
            </div>
        </div>
    </div>
</footer>

<script>
    const STORAGE_KEY = 'majeeo-cart';
    const ORDERS_DB = 'majeeo-orders-db';
    const CURRENT_USER = 'majeeo-current-user';
    
    const products = [
        { name:"Premium Almonds (Badam)", img:"images/almonds.webp", price:1, desc:"High-quality California almonds.", best:true, link:"#" }, // PRICE IS 1
        { name:"Premium Cashews (Kaju)", img:"images/cashews.avif", price:1200, desc:"Fresh, creamy cashews.", best:true, link:"#" },
        { name:"Mamra Almonds (Organic)", img:"images/mamra_almonds.webp", price:1600, desc:"Premium organic Mamra almonds.", best:false, link:"#" },
        { name:"Pista (Pistachios)", img:"images/Pista.jpg", price:1400, desc:"Crunchy, lightly salted pistachios.", best:false, link:"#" },
        { name:"Walnut (Akhrot)", img:"images/Walnut.png", price:1300, desc:"Brain‚Äëboosting walnuts rich in Omega‚Äë3.", best:false, link:"#" },
        { name:"Raisins (Kishmish)", img:"images/Raisins.png", price:600, desc:"Sweet, sun‚Äëdried raisins.", best:false, link:"#" },
        { name:"Mix Dry Fruits", img:"images/Mix_Dryfruits.jpg", price:1500, desc:"Mix of almonds, cashews, pista, raisins & figs.", best:false, link:"#" },
        { name:"Anjeer (Figs)", img:"images/Anjeer.png", price:900, desc:"Naturally sweet sun‚Äëdried figs.", best:false, link:"#" }
    ];

    const getCart = () => JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    const saveCart = (c) => { localStorage.setItem(STORAGE_KEY, JSON.stringify(c)); renderCart(); };
    
    const productGrid = document.getElementById('product-grid-container');
    const cartItemsDiv = document.getElementById('cart-items');
    const badge = document.getElementById('cart-count');
    const cartTotalSpan = document.getElementById('cart-total');
    const checkoutBtn = document.getElementById('checkout-btn');
    const noResults = document.getElementById('no-results');

    function renderProducts(filterText = '') {
        productGrid.innerHTML = '';
        let count = 0;
        products.forEach(p => {
            if(p.name.toLowerCase().includes(filterText.toLowerCase())) {
                count++;
                const card = document.createElement('article');
                card.className = 'bg-white rounded-xl shadow-lg border border-gray-100 p-4 hover:shadow-xl transition duration-300';
                card.innerHTML = `
                    <div class="relative">
                         <img src="${p.img}" onerror="this.src='https://placehold.co/300x300?text=No+Image'" class="w-full h-40 object-contain rounded-lg mb-3">
                         ${p.best ? '<span class="absolute top-0 right-0 bg-brand-gold text-brand-red text-xs font-bold px-2 py-1 rounded">BESTSELLER</span>' : ''}
                    </div>
                    <h3 class="font-serif font-semibold text-lg text-brand-dark leading-tight mb-1">${p.name}</h3>
                    <p class="text-brand-red font-bold text-xl mb-3">‚Çπ${p.price}/kg</p>
                    <div class="flex justify-between items-center gap-2">
                        <select class="unit-select p-2 border border-gray-300 rounded text-sm flex-grow">
                            <option value="250">250g</option>
                            <option value="500">500g</option>
                            <option value="1000" selected>1kg</option>
                        </select>
                        <button class="add-to-cart bg-brand-red text-white p-2 rounded-lg hover:bg-brand-dark transition" 
                                data-name="${p.name}" data-price="${p.price}" data-img="${p.img}">
                            <i class="ri-shopping-cart-line"></i>
                        </button>
                    </div>`;
                productGrid.appendChild(card);
            }
        });
        noResults.classList.toggle('hidden', count > 0);
    }

    function renderCart() {
        const c = getCart();
        const total = c.reduce((sum, i) => sum + i.price, 0);
        badge.textContent = c.reduce((s, i) => s + i.count, 0);
        cartTotalSpan.textContent = `‚Çπ${total.toFixed(2)}`;
        checkoutBtn.disabled = c.length === 0;
        
        cartItemsDiv.innerHTML = c.map((item, i) => `
            <div class="flex justify-between items-center border-b pb-2 gap-2">
                <div class="flex-grow">
                    <p class="font-bold text-brand-dark text-sm">${item.name}</p>
                    <p class="text-xs text-gray-500">${item.count} x ${item.unitGrams}g = ‚Çπ${item.price.toFixed(2)}</p>
                </div>
                <div class="flex items-center gap-1 bg-gray-100 rounded">
                     <button onclick="updateQty(${i}, -1)" class="px-2 py-1 hover:bg-gray-200 rounded-l transition">-</button>
                     <span class="text-xs font-bold px-1">${item.count}</span>
                     <button onclick="updateQty(${i}, 1)" class="px-2 py-1 hover:bg-gray-200 rounded-r transition">+</button>
                </div>
                <button onclick="removeAll(${i})" class="text-red-600 hover:text-red-800 ml-1"><i class="ri-delete-bin-line"></i></button>
            </div>
        `).join('');
    }

    function updateQty(index, delta) {
        const c = getCart();
        const item = c[index];
        const unitPrice = item.price / item.count;
        const unitGrams = item.unitGrams;
        if (item.count + delta > 0) {
            item.count += delta;
            item.price += unitPrice * delta;
            item.grams += unitGrams * delta;
        } else { return; }
        saveCart(c);
    }

    function removeAll(index) {
        if(confirm("Remove this item?")) {
            const c = getCart();
            c.splice(index, 1);
            saveCart(c);
        }
    }

    document.addEventListener('click', e => {
        if (e.target.closest('.add-to-cart')) {
            const btn = e.target.closest('.add-to-cart');
            const card = btn.closest('article');
            const grams = parseInt(card.querySelector('.unit-select').value);
            const name = btn.dataset.name;
            const img = btn.dataset.img;
            const price = (parseFloat(btn.dataset.price) / 1000) * grams;
            const cart = getCart();
            const existing = cart.find(i => i.name === name && i.unitGrams === grams);
            if (existing) { existing.count++; existing.grams += grams; existing.price += price; } 
            else { cart.push({ name, grams, price, count: 1, unitGrams: grams, img }); }
            saveCart(cart);
            toggleCartSidebar(true);
        }
    });
    
    const params = new URLSearchParams(window.location.search);
    const search = params.get('search');
    if(search) { document.getElementById('searchInput').value = search; renderProducts(search); } 
    else { renderProducts(); }
    
    document.getElementById('searchInput').addEventListener('input', (e) => renderProducts(e.target.value));

    function toggleMenu() {
        document.getElementById('mobile-menu-overlay').classList.toggle('hidden');
        document.getElementById('mobile-sidebar').classList.toggle('-translate-x-full');
    }
    
    function toggleCartSidebar(forceOpen = false) {
        const sidebar = document.getElementById('cart-sidebar');
        const overlay = document.getElementById('cart-overlay');
        if (forceOpen) {
            sidebar.classList.remove('translate-x-full');
            overlay.classList.remove('hidden');
        } else {
            sidebar.classList.toggle('translate-x-full');
            overlay.classList.toggle('hidden');
        }
    }

    checkoutBtn.addEventListener('click', () => {
        const activeUser = JSON.parse(localStorage.getItem(CURRENT_USER));
        if (!activeUser) {
            alert("Please Login or Sign Up to complete your order!");
            window.location.href = "account.html";
            return;
        }

        const emailInput = document.getElementById('customer-email');
        const customerEmail = emailInput.value || activeUser.email;

        if (!customerEmail || !customerEmail.includes('@')) {
            alert("Please enter a valid email address.");
            emailInput.focus();
            return;
        }

        const cart = getCart();
        const total = cart.reduce((s, i) => s + i.price, 0);
        
        new Razorpay({
            key: "rzp_live_LIqOpioBHDIhG4", 
            amount: Math.round(total * 100),
            currency: "INR",
            name: "MajeeoNuts",
            prefill: { email: customerEmail },
            handler: (resp) => {
                // --- SEQUENTIAL ORDER ID LOGIC ---
                const today = new Date();
                // Format: YYYYMMDD (e.g., 20251122)
                const dateStr = today.getFullYear() + "" + String(today.getMonth() + 1).padStart(2, '0') + String(today.getDate()).padStart(2, '0');
                
                // Get existing orders from DB
                const allOrders = JSON.parse(localStorage.getItem(ORDERS_DB)) || [];
                // Filter for orders created today to calculate sequence
                const todayOrdersCount = allOrders.filter(o => o.id && o.id.startsWith('MN-' + dateStr)).length;
                
                // Sequence is Count + 1, padded to 3 digits (e.g., 001, 002)
                const nextSeq = String(todayOrdersCount + 1).padStart(3, '0');
                
                // Final ID: MN-20251122-001
                const orderId = `MN-${dateStr}-${nextSeq}`;

                const newOrder = {
                    id: orderId,
                    timestamp: new Date().getTime(),
                    date: today.toDateString(),
                    userEmail: activeUser.email,
                    items: cart,
                    total: total,
                    status: 'Paid',
                    paymentId: resp.razorpay_payment_id
                };

                allOrders.unshift(newOrder);
                localStorage.setItem(ORDERS_DB, JSON.stringify(allOrders));

                const itemsList = cart.map(i => `${i.name} (${i.count} x ${i.unitGrams}g) - Rs.${i.price}`).join(' | ');
                fetch("https://formsubmit.co/ajax/maheshgawade7799@gmail.com", {
                    method: "POST",
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify({
                        email: customerEmail,
                        _subject: `Invoice: Order #${orderId}`,
                        _cc: customerEmail,
                        _template: "table",
                        "Order ID": orderId,
                        "Amount": `‚Çπ${total}`,
                        "Items": itemsList
                    })
                });

                alert("Payment Successful! Order ID: " + orderId);
                localStorage.removeItem(STORAGE_KEY);
                renderCart();
                window.location.href = 'account.html';
            },
            theme: { color: "#7f1d1d" }
        }).open();
    });

    renderCart();
</script>
</body>
</html>