<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Track Order – MajeeoNuts</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand: { red: '#7f1d1d', gold: '#D4AF37', cream: '#F9F5F1', dark: '#1A1A1A' } },
          fontFamily: { sans: ['Poppins', 'sans-serif'], serif: ['Playfair Display', 'serif'] }
        }
      }
    }
  </script>
</head>
<body class="bg-brand-cream text-brand-dark font-sans antialiased">

<nav id="navbar" class="sticky top-0 z-50 bg-white shadow-md">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex justify-between items-center">
        <a href="index.html" class="flex items-center gap-2">
            <img src="assets/images/Product/Images/MajeeoNuts.Logo.png" onerror="this.src='images/MajeeoNuts.Logo.png'" alt="MajeeoNuts" class="h-12 w-auto object-contain">
            <span class="text-2xl font-serif font-bold text-brand-red">MajeeoNuts</span>
        </a>
        <div class="flex items-center space-x-4 text-brand-red">
            <a href="shop.html" class="hover:text-brand-gold">Shop</a>
            <a href="account.html"><i class="ri-user-line text-xl"></i></a>
        </div>
    </div>
</nav>

<main class="max-w-3xl mx-auto px-4 py-12 min-h-[600px]">
    <h1 class="text-3xl font-serif font-bold text-brand-red mb-8 text-center">Track Your Order</h1>
    
    <!-- Search Box -->
    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 mb-8">
        <label class="block text-sm font-bold text-gray-700 mb-2">Enter Order ID</label>
        <div class="flex gap-2">
            <input type="text" id="track-input" placeholder="e.g. MN-20251122-1234" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-gold outline-none">
            <button onclick="trackOrder()" class="bg-brand-red text-white px-6 py-3 rounded-lg font-bold hover:bg-brand-dark transition">Track</button>
        </div>
    </div>

    <!-- Tracking Result (Hidden by default) -->
    <div id="tracking-result" class="hidden bg-white p-8 rounded-xl shadow-lg border border-gray-100">
        <div class="flex justify-between items-start mb-8 border-b pb-4">
            <div>
                <h2 class="text-xl font-bold text-brand-dark">Order <span id="order-id-display"></span></h2>
                <p class="text-gray-500 text-sm" id="order-date-display"></p>
            </div>
            <span class="bg-green-100 text-green-800 text-xs font-bold px-3 py-1 rounded-full" id="order-status-badge">Paid</span>
        </div>

        <!-- Timeline -->
        <div class="relative">
            <!-- Vertical Line -->
            <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"></div>

            <!-- Steps -->
            <div class="space-y-8 relative">
                <!-- Step 1 -->
                <div class="flex items-center gap-4">
                    <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white z-10 shadow-md"><i class="ri-check-line"></i></div>
                    <div>
                        <h4 class="font-bold text-brand-dark">Order Placed</h4>
                        <p class="text-xs text-gray-500">We have received your order.</p>
                    </div>
                </div>

                <!-- Step 2 (Packed) -->
                <div class="flex items-center gap-4 opacity-50" id="step-packed">
                    <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-white z-10" id="icon-packed"><i class="ri-box-3-line"></i></div>
                    <div>
                        <h4 class="font-bold text-brand-dark">Packed</h4>
                        <p class="text-xs text-gray-500">Your dry fruits are packed with care.</p>
                    </div>
                </div>

                <!-- Step 3 (Shipped) -->
                <div class="flex items-center gap-4 opacity-50" id="step-shipped">
                    <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-white z-10" id="icon-shipped"><i class="ri-truck-line"></i></div>
                    <div>
                        <h4 class="font-bold text-brand-dark">Shipped</h4>
                        <p class="text-xs text-gray-500">On the way to your doorstep.</p>
                    </div>
                </div>

                <!-- Step 4 (Delivered) -->
                <div class="flex items-center gap-4 opacity-50" id="step-delivered">
                    <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-white z-10" id="icon-delivered"><i class="ri-home-smile-line"></i></div>
                    <div>
                        <h4 class="font-bold text-brand-dark">Delivered</h4>
                        <p class="text-xs text-gray-500">Enjoy your premium nuts!</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-100 text-sm text-blue-800 flex items-start gap-2">
            <i class="ri-information-line text-lg"></i>
            <p>Delivery typically takes 3-5 business days. For support, contact us on WhatsApp.</p>
        </div>
    </div>
    
    <p id="error-msg" class="text-center text-red-500 font-bold hidden mt-4">Order ID not found.</p>

</main>

<script>
    const ORDERS_DB = 'majeeo-orders-db';

    // Auto-track if ID is in URL
    const params = new URLSearchParams(window.location.search);
    const urlId = params.get('id');
    if(urlId) {
        document.getElementById('track-input').value = urlId;
        trackOrder();
    }

    function trackOrder() {
        const inputId = document.getElementById('track-input').value.trim();
        const orders = JSON.parse(localStorage.getItem(ORDERS_DB)) || [];
        const order = orders.find(o => o.id === inputId);
        
        const resultDiv = document.getElementById('tracking-result');
        const errorMsg = document.getElementById('error-msg');

        if (!order) {
            resultDiv.classList.add('hidden');
            errorMsg.classList.remove('hidden');
            return;
        }

        errorMsg.classList.add('hidden');
        resultDiv.classList.remove('hidden');

        // Fill Basic Data
        document.getElementById('order-id-display').innerText = order.id;
        // Handle date format properly
        let orderDateObj = new Date();
        // Check if date is stored as string or timestamp
        if(order.timestamp) { 
             orderDateObj = new Date(order.timestamp);
        }
        
        document.getElementById('order-date-display').innerText = "Placed on " + orderDateObj.toDateString();

        // --- SIMULATE STATUS BASED ON TIME PASSED ---
        // Real logic: You would update status in database manually.
        // Simulation: 
        // < 1 hour: Placed
        // > 1 hour: Packed
        // > 24 hours: Shipped
        // > 3 days: Delivered
        
        const now = new Date();
        const diffHours = Math.abs(now - orderDateObj) / 36e5;

        updateStep('packed', diffHours > 0.05); // Packed after 3 mins (for demo)
        updateStep('shipped', diffHours > 24);  // Shipped after 24 hours
        updateStep('delivered', diffHours > 72); // Delivered after 3 days
        
        if(diffHours > 72) document.getElementById('order-status-badge').innerText = "Delivered";
        else if(diffHours > 24) document.getElementById('order-status-badge').innerText = "Shipped";
        else if(diffHours > 0.05) document.getElementById('order-status-badge').innerText = "Packed";
    }

    function updateStep(stepName, isActive) {
        const stepDiv = document.getElementById('step-' + stepName);
        const iconDiv = document.getElementById('icon-' + stepName);
        
        if (isActive) {
            stepDiv.classList.remove('opacity-50');
            iconDiv.classList.remove('bg-gray-300');
            iconDiv.classList.add('bg-green-500', 'shadow-md');
        } else {
            stepDiv.classList.add('opacity-50');
            iconDiv.classList.add('bg-gray-300');
            iconDiv.classList.remove('bg-green-500', 'shadow-md');
        }
    }
</script>
</body>
</html>
```

---

### 2. Updated Shop Page (`shop.html`)
* **Feature:** Generates a better **Order ID** (`MN-YYYYMMDD-RANDOM`) and saves a **Timestamp** for the tracking simulation logic.

**Action:** Update just the `checkoutBtn` event listener logic in `shop.html`.

```javascript
// REPLACE THE CHECKOUT HANDLER IN YOUR EXISTING shop.html SCRIPT
handler: (resp) => {
    // 1. Generate Professional ID: MN-20251122-1234
    const today = new Date();
    const dateStr = today.getFullYear() + "" + String(today.getMonth() + 1).padStart(2, '0') + String(today.getDate()).padStart(2, '0');
    const orderId = 'MN-' + dateStr + '-' + Math.floor(1000 + Math.random() * 9000);

    const newOrder = {
        id: orderId,
        timestamp: new Date().getTime(), // Critical for tracking simulation
        date: today.toDateString(),
        userEmail: activeUser.email,
        items: cart,
        total: total,
        status: 'Paid',
        paymentId: resp.razorpay_payment_id
    };

    // Save to DB
    const orders = JSON.parse(localStorage.getItem(ORDERS_DB)) || [];
    orders.unshift(newOrder);
    localStorage.setItem(ORDERS_DB, JSON.stringify(orders));

    // Send Invoice Email
    const itemsList = cart.map(i => `${i.name} (${i.count}x)`).join(', ');
    fetch("https://formsubmit.co/ajax/maheshgawade7799@gmail.com", {
        method: "POST",
        headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
        body: JSON.stringify({
            email: customerEmail,
            _subject: `Invoice: Order #${orderId}`,
            _cc: customerEmail,
            _template: "table",
            "Order ID": orderId,
            "Total": `Rs. ${total}`,
            "Items": itemsList,
            "Track Order": `https://newmajeeo.netlify.app/track.html?id=${orderId}`
        })
    });

    alert("Order Successful! ID: " + orderId);
    localStorage.removeItem(STORAGE_KEY);
    renderCart(); // Clear cart UI
    window.location.href = 'account.html'; // Redirect
},
```

---

### 3. Updated Account Page (`account.html`)
* **Feature:** Added a **"Track Order" button** next to every order in the history list that takes you to the tracking page.

**Action:** Update the `renderOrders` function in `account.html`.

```javascript
// REPLACE THE renderOrders FUNCTION IN YOUR account.html SCRIPT
function renderOrders(userEmail) {
    const allOrders = JSON.parse(localStorage.getItem(ORDERS_DB)) || [];
    const userOrders = allOrders.filter(o => o.userEmail === userEmail);
    const container = document.getElementById('orders-list');

    if(userOrders.length === 0) {
        container.innerHTML = `<p class="text-center text-gray-500">No orders yet. <a href="shop.html" class="text-brand-red underline">Shop Now</a></p>`;
        return;
    }

    container.innerHTML = userOrders.reverse().map(order => `
        <div class="border border-gray-200 rounded-xl p-5 hover:shadow-lg transition bg-white">
            <div class="flex justify-between items-start border-b border-gray-100 pb-4 mb-4">
                <div>
                    <p class="font-bold text-lg text-brand-dark">Order #${order.id}</p>
                    <p class="text-xs text-gray-500">${order.date}</p>
                </div>
                <!-- TRACK BUTTON ADDED HERE -->
                <a href="track.html?id=${order.id}" class="bg-brand-gold text-brand-red text-xs font-bold px-3 py-2 rounded-lg hover:bg-brand-dark hover:text-white transition">
                    Track Order
                </a>
            </div>
            <div class="text-sm text-gray-600 space-y-1">
                ${order.items.map(i => `<p>${i.name} (${i.count}x)</p>`).join('')}
            </div>
            <div class="mt-4 pt-3 border-t border-gray-100 font-bold text-right text-brand-dark">
                Total: ₹${order.total}
            </div>
        </div>
    `).join('');
}